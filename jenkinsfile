#!/usr/bin/env groov
pipeline {
    agent any
    stages {
      stage("Teste"){
        steps {
          echo 'Teste stage'
        }
      }

       stage('NPM Install') {
        nodejs(nodeJSInstallationName: 'Node 6.x', configId: '<config-file-provider-id>') {
            sh 'npm install'
        }
      }

      // stage('Test') {
      //     withEnv(["CHROME_BIN=/usr/bin/chromium-browser"]) {
      //       sh 'ng test --progress=false --watch false'
      //     }
      //     junit '**/test-results.xml'
      // }

      // stage('Lint') {
      //     sh 'ng lint'
      // }

      stage('Build') {
        nodejs(nodeJSInstallationName: 'Node 6.x', configId: '<config-file-provider-id>') {
          sh 'ng build --prod --aot --sm --progress=false'
        }
      }

      // stage('Archive') {
      //     sh 'tar -cvzf dist.tar.gz --strip-components=1 dist'
      //     archive 'dist.tar.gz'
      // }

      stage('Deploy') {
          // milestone()
        nodejs(nodeJSInstallationName: 'Node 6.x', configId: '<config-file-provider-id>') {
          echo "Deploying..."
        }
      }


    //   stage("Get Source") {
    //         steps {
    //             git url: 'https://github.com/xcarlosr/mfe-poc.git', branch: 'master'
    //         }
    //     }
    //     stage("Docker Build") {
    //         steps {
    //             script {
    //               dockerapp = docker.build("mfe/dashboard:${evn.BUILD_ID}"),
    //               "-f ./apps/dashboard/Dockerfile ."
    //             }
    //         }
    //     }
    //     stage("Docker push Image") {
    //         steps {
    //             docker.withRegistry('https://registry.hub.dokcer.com', 'dokcerhub'){
    //               dockerapp.push('latest')
    //               dokcerapp.push("${evn.BUILD_ID}")
    //             }
    //         }
    //     }
    }
}
